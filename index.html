<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2C2F33">
    <meta name="description" content="Collectez et √©voluez vos Pok√©mon pr√©f√©r√©s dans cette aventure immersive !">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Pok√©mon Collector">
    <title>Pok√©mon Blind Box Collector V6.2</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    <!-- POLISHING : Typographie professionnelle -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- ‚úÖ CORRECTION : Polices pixel pour l'intro -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- React & Dependencies for Pok√©-Poker -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js for 3D Pok√©ball -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Supabase for Cloud Save -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes shine {
            0%, 100% {
                filter: brightness(1);
                transform: scale(1);
            }
            50% {
                filter: brightness(1.5);
                transform: scale(1.1);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(125, 95, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(125, 95, 255, 0.6);
            }
        }
        
        /* ===== POK√â-POKER STYLES ===== */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap');
        
        :root { --bg-dark: #050510; }
        
        #poker-page .crt::before { 
            content: " "; 
            display: block; 
            position: absolute; 
            top: 0; 
            left: 0; 
            bottom: 0; 
            right: 0; 
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); 
            z-index: 999; 
            background-size: 100% 2px, 3px 100%; 
            pointer-events: none; 
        }
        
        #poker-page .pixel-font { font-family: 'Press Start 2P', monospace; }
        #poker-page .pixel-border { box-shadow: -3px 0 0 0 black, 3px 0 0 0 black, 0 -3px 0 0 black, 0 3px 0 0 black; margin: 3px; }
        #poker-page .neon-text { text-shadow: 2px 2px 0px #000, 0 0 10px currentColor; }
        #poker-page .modal-backdrop { background-color: rgba(0,0,0,0.95); backdrop-filter: blur(8px); }
        #poker-page .card-container { image-rendering: pixelated; transition: transform 0.2s; background-size: cover; background-position: center; position: relative; box-shadow: 4px 4px 0px rgba(0,0,0,0.5); }
        #poker-page .card-container:hover { transform: translateY(-10px) scale(1.05); z-index: 40; }
        #poker-page .card-container.selected { transform: translateY(-25px) !important; box-shadow: 0 0 0 3px #fbbf24, 0 0 15px #fbbf24 !important; z-index: 50 !important; border-color: #fbbf24 !important; }
        #poker-page .card-container.scoring { transform: translateY(-40px) scale(1.2) !important; box-shadow: 0 0 0 4px #fff, 0 0 40px #fff !important; z-index: 100 !important; filter: brightness(1.2) !important; }
        #poker-page .card-container.dimmed { filter: brightness(0.4) grayscale(0.8); transform: scale(0.95); }
        #poker-page .is-shiny { position: relative; overflow: hidden; border: 2px solid #ffd700 !important; box-shadow: 0 0 15px #ffd700; }
        #poker-page .is-shiny::after { content: ""; position: absolute; top: -100%; left: -100%; width: 300%; height: 300%; background: linear-gradient(115deg, transparent 20%, rgba(255,0,0,0.4) 30%, rgba(255,255,0,0.4) 40%, rgba(0,255,0,0.4) 50%, rgba(0,255,255,0.4) 60%, rgba(0,0,255,0.4) 70%, rgba(255,0,255,0.4) 80%, transparent 90%); mix-blend-mode: color-dodge; animation: holo-shine 3s linear infinite; pointer-events: none; }
        @keyframes holo-shine { 0% { transform: translate(0,0) rotate(0deg); } 100% { transform: translate(20px, 20px) rotate(360deg); } }
        #poker-page .pokeball-pattern { background-image: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 15%, transparent 16%), linear-gradient(to bottom, transparent 48%, rgba(0,0,0,0.15) 48%, rgba(0,0,0,0.15) 52%, transparent 52%); pointer-events: none; }
        @keyframes slideIn { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #poker-page .animate-slide-in { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 15px #60a5fa; } 50% { box-shadow: 0 0 30px #3b82f6; } }
        #poker-page .animate-pulse-glow { animation: pulse-glow 2s infinite; }
        @keyframes secret-unlock { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        #poker-page .animate-secret { animation: secret-unlock 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes defeat-shake { 0% { transform: translate(0,0); filter: brightness(1); } 20% { transform: translate(-10px, 0); filter: brightness(1); } 40% { transform: translate(10px, 0); filter: brightness(0.8); } 60% { transform: translate(-10px, 0); filter: brightness(0.6); } 80% { transform: translate(10px, 0); filter: brightness(0.4); opacity: 1; } 100% { transform: translate(0,0); filter: brightness(0); opacity: 0; scale: 0.8; } }
        #poker-page .animate-defeat { animation: defeat-shake 2s forwards; }
        @keyframes badge-appear { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 70% { transform: scale(1.5) rotate(10deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        #poker-page .animate-badge { animation: badge-appear 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        #poker-page .animate-bounce-slow { animation: bounce-slow 3s ease-in-out infinite; }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        #poker-page .animate-shimmer { animation: shimmer 2s ease-in-out infinite; }
        
        #poker-page { background-color: var(--bg-dark); color: #e2e8f0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; overflow: hidden; user-select: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100vh; z-index: 1000; }
        
        /* Cacher les barres de menu quand on est sur la page poker */
        body:has(#poker-page.active) .top-bar,
        body:has(#poker-page.active):not(:has(.poker-start-screen)) .bottom-nav {
            display: none !important;
        }
        
        /* Am√©liorer la lisibilit√© sur mobile */
        @media (max-width: 768px) {
            #poker-page {
                font-size: 16px;
            }
            
            #poker-page .pixel-font {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                font-weight: bold;
                letter-spacing: 0.5px;
            }
            
            #poker-page .font-vt323 {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                font-weight: 600;
            }
            
            /* Agrandir les cartes sur mobile - 2 lignes de 4 */
            #poker-page .card-container {
                min-width: 90px !important;
                min-height: 130px !important;
                width: 90px !important;
                height: 130px !important;
            }
            
            /* Forcer 2 lignes de 4 cartes sur mobile */
            #poker-page .flex.flex-wrap.gap-2,
            #poker-page .flex.flex-wrap.gap-3,
            #poker-page .flex.flex-wrap.gap-4 {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                grid-template-rows: repeat(2, auto) !important;
                gap: 6px !important;
                max-height: none !important;
                overflow-y: visible !important;
                justify-items: center;
                align-items: end;
            }
            
            /* Interface des dresseurs sur mobile - plus compacte */
            #poker-page .min-h-\[400px\] {
                min-height: 320px !important;
            }
            
            /* Espacement des dresseurs sur mobile */
            #poker-page .gap-4.md\\:gap-12,
            #poker-page .gap-4.md\\:gap-12 > * {
                gap: 8px !important;
            }
            
            /* Centrer les sprites dans les cartes */
            #poker-page .card-container img {
                display: block;
                margin: 0 auto;
                object-fit: contain;
                object-position: center;
            }
        }
        
        /* Mode paysage - garder la police lisible */
        @media (orientation: landscape) and (max-height: 600px) {
            #poker-page {
                font-size: 14px !important;
            }
            
            #poker-page .pixel-font {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                font-weight: bold !important;
                letter-spacing: 0.5px !important;
            }
            
            #poker-page .font-vt323 {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                font-weight: 600 !important;
            }
            
            /* Agrandir le texte dans les cartes */
            #poker-page .text-\[10px\],
            #poker-page .text-\[8px\] {
                font-size: 12px !important;
            }
            
            /* Ajuster les boutons */
            #poker-page button {
                font-size: 14px !important;
                padding: 10px 16px !important;
                min-height: 44px; /* Taille tactile minimale */
            }
            
            /* Ajuster les textes */
            #poker-page .text-xs {
                font-size: 13px !important;
            }
            
            /* R√©duire les espacements pour tout faire tenir */
            #poker-page .p-4 {
                padding: 12px !important;
            }
            
            #poker-page .p-8 {
                padding: 16px !important;
            }
            
            #poker-page .gap-8 {
                gap: 12px !important;
            }
        }
        
        /* Styles globaux pour centrer tous les sprites anim√©s */
        img[src*="generation-v/black-white/animated"] {
            object-fit: contain !important;
            object-position: center !important;
            display: block;
            margin: 0 auto;
            image-rendering: pixelated;
        }
        
        /* ===== DATA GUARDIAN - BOSS BATTLE STYLES ===== */
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        :root {
            --boss-primary: #00ff9d;
            --boss-primary-glow: rgba(0, 255, 157, 0.4);
            --boss-danger: #ff0055;
            --boss-danger-glow: rgba(255, 0, 85, 0.4);
            --boss-bg-dark: #050510;
            --boss-panel-bg: rgba(20, 25, 40, 0.85);
            --boss-text-main: #e0e6ed;
            --boss-font: 'Share Tech Mono', monospace;
        }
        
        #boss-battle-page {
            background-color: var(--boss-bg-dark);
            background-image: 
                linear-gradient(rgba(0, 255, 157, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 157, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            color: var(--boss-text-main);
            font-family: var(--boss-font);
            position: relative;
            overflow: hidden;
        }
        
        /* Scanlines CRT Effect */
        #boss-battle-page::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
        }
        
        /* Timeline Container */
        .boss-timeline {
            height: 50px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 0 15px;
            z-index: 10;
            flex-shrink: 0;
        }
        
        .timeline-portrait {
            width: 40px;
            height: 40px;
            border: 2px solid #333;
            border-radius: 50%;
            background: #222;
            position: relative;
            overflow: hidden;
        }
        
        .timeline-portrait.active {
            border-color: var(--boss-primary);
            box-shadow: 0 0 10px var(--boss-primary);
        }
        
        .timeline-portrait.boss {
            border-color: var(--boss-danger);
            box-shadow: 0 0 10px var(--boss-danger);
        }
        
        .timeline-portrait img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            image-rendering: pixelated;
        }
        
        /* Battle Stage */
        .boss-battle-stage {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: calc(100vh - 200px);
        }
        
        /* Boss Zone (Top Right) */
        .boss-zone {
            position: absolute;
            top: 20px;
            right: -20px;
            width: 70%;
            height: 40%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }
        
        .boss-card {
            position: absolute;
            top: 0;
            right: 40px;
            text-align: right;
            z-index: 6;
        }
        
        .boss-name {
            color: var(--boss-danger);
            font-size: 16px;
            text-shadow: 0 0 10px var(--boss-danger);
            letter-spacing: 1px;
            font-weight: bold;
            background: rgba(0,0,0,0.6);
            padding: 2px 5px;
        }
        
        .boss-hp-bar {
            width: 180px;
            height: 6px;
            background: #222;
            border: 1px solid #555;
            margin-top: 2px;
            transform: skewX(-20deg);
            overflow: hidden;
            margin-left: auto;
        }
        
        .boss-hp-fill {
            height: 100%;
            background: var(--boss-danger);
            box-shadow: 0 0 10px var(--boss-danger);
            transition: width 0.3s ease-out;
        }
        
        .boss-visual {
            width: 180px;
            height: 180px;
            margin-top: 20px;
            margin-right: 20px;
        }
        
        .boss-sprite {
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: pixelated;
            filter: grayscale(80%) sepia(20%) hue-rotate(-50deg) saturate(300%) contrast(1.2);
            filter: drop-shadow(0 0 10px rgba(255,0,85,0.3));
            animation: boss-float 4s ease-in-out infinite, boss-glitch 3s infinite linear alternate-reverse;
        }
        
        .boss-aura {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(255, 0, 85, 0.4) 0%, transparent 70%);
            z-index: 1;
            animation: pulse-aura 2s infinite;
        }
        
        @keyframes boss-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes boss-glitch {
            0% { clip-path: inset(0 0 0 0); transform: translate(0); }
            5% { clip-path: inset(10% 0 80% 0); transform: translate(-2px, 2px); }
            10% { clip-path: inset(80% 0 5% 0); transform: translate(2px, -2px); }
            15% { clip-path: inset(0 0 0 0); transform: translate(0); }
            60% { filter: invert(1); }
            62% { filter: grayscale(80%) sepia(20%) hue-rotate(-50deg) saturate(300%); }
            100% { clip-path: inset(0 0 0 0); transform: translate(0); }
        }
        
        @keyframes pulse-aura {
            0% { opacity: 0.3; transform: scale(0.9); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 0.3; transform: scale(0.9); }
        }
        
        /* Animations de feedback combat */
        @keyframes damageFloat {
            0% { opacity: 1; transform: translate(-50%, -50%) translateY(0) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) translateY(-80px) scale(1.5); }
        }
        
        @keyframes healFloat {
            0% { opacity: 1; transform: translate(-50%, -50%) translateY(0) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) translateY(-60px) scale(1.3); }
        }
        
        @keyframes attackPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3); }
        }
        
        @keyframes healGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 0 rgba(0,255,157,0)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(0,255,157,0.8)); }
        }
        
        @keyframes buffShine {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.4) drop-shadow(0 0 15px rgba(255,215,0,0.6)); }
        }
        
        /* Animation de shake pour les d√©g√¢ts re√ßus */
        @keyframes damageShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* Player Zone (Bottom Left) */
        .player-zone {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 55%;
            z-index: 10;
        }
        
        .team-formation {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .active-unit {
            position: absolute;
            bottom: 20px;
            left: 30%;
            width: 200px;
            height: 200px;
            z-index: 20;
            transform: translateX(-50%);
        }
        
        .active-sprite {
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: pixelated;
            filter: drop-shadow(0 0 5px rgba(0, 255, 157, 0.5));
            transform: scale(1.6);
            transition: transform 0.2s;
        }
        
        .support-unit {
            position: absolute;
            width: 120px;
            height: 120px;
            opacity: 0.8;
            filter: brightness(0.6) grayscale(30%);
            z-index: 5;
            transition: all 0.3s;
        }
        
        .support-unit.s1 {
            bottom: 60px;
            left: -20px;
            transform: scale(0.9);
        }
        
        .support-unit.s2 {
            bottom: 120px;
            left: 20px;
            transform: scale(0.85);
            z-index: 4;
        }
        
        .player-hud {
            position: absolute;
            bottom: 120px;
            right: 10px;
            text-align: right;
            z-index: 30;
        }
        
        .player-name {
            font-size: 14px;
            color: #fff;
            background: rgba(0,0,0,0.7);
            padding: 2px 8px;
            display: inline-block;
            border-left: 2px solid var(--boss-primary);
        }
        
        .player-hp-bar {
            width: 140px;
            height: 8px;
            background: #333;
            margin-left: auto;
            margin-top: 2px;
            border: 1px solid #555;
            transform: skewX(-20deg);
        }
        
        .player-hp-fill {
            height: 100%;
            background: var(--boss-primary);
            box-shadow: 0 0 5px var(--boss-primary);
            transition: width 0.3s ease-out;
        }
        
        /* Control Panel */
        .boss-control-panel {
            background: var(--boss-panel-bg);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--boss-primary);
            padding: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            z-index: 50;
            flex-shrink: 0;
        }
        
        .action-btn {
            background: linear-gradient(180deg, #1a2a3a 0%, #0d1218 100%);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            height: 65px;
            color: white;
            font-family: var(--boss-font);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            border-color: var(--boss-primary);
            transform: translateY(-2px);
        }
        
        .action-btn:active {
            background: #222;
            transform: translateY(2px);
        }
        
        .action-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-icon {
            font-size: 22px;
            margin-bottom: 2px;
        }
        
        .btn-label {
            font-size: 11px;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        
        .cooldown-indicator {
            font-size: 10px;
            color: #888;
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <!-- INTRO OVERLAY (Nouvelle S√©quence Mobile First) -->
    <div id="game-boy-screen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 50000;">
        <div class="scanlines"></div>
        
        <!-- START SCREEN -->
        <div id="start-screen">
            <h1>POK√âMON<br>1511</h1>
            <button class="start-btn" onclick="window.startIntroSequence()">NOUVELLE PARTIE</button>
        </div>
        
        <!-- PHASE 1 : PROF CHEN -->
        <div id="scene-retro" class="scene-retro hidden">
            <div class="actors-container">
                <!-- Sprite Chen (Source Fiable) -->
                <img src="https://play.pokemonshowdown.com/sprites/trainers/oak.png" id="oak-sprite" class="prof-sprite" alt="Prof Chen" onerror="this.style.display='none'; document.getElementById('oak-fallback').style.display='block';">
                <div id="oak-fallback" class="prof-fallback">üë®‚Äçüî¨</div>
                
                <!-- ANIMATION POKEMON -->
                <div id="intro-pkmn-container" class="intro-pokemon-container">
                    <div id="pokeball-anim" class="pokeball-throw"></div>
                    <div id="flash-anim" class="flash-effect"></div>
                    <!-- Gengar (Ectoplasma) - ID 94 -->
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/94.png" id="intro-pokemon" class="pokemon-intro-sprite" alt="Ectoplasma">
                </div>
            </div>
            
            <div class="dialog-container">
                <div class="dialog-box-retro">
                    <span id="retro-text"></span>
                    <div id="retro-arrow" class="next-arrow">‚ñº</div>
                </div>
            </div>
        </div>
        
        <!-- PHASE 2 : TERMINAL -->
        <div id="terminal-screen"></div>
        
        <!-- PHASE 3 : PORYGON-Z -->
        <div id="porygon-scene">
            <div class="cyber-grid"></div>
            <img src="https://img.pokemondb.net/sprites/black-white/anim/normal/porygon-z.gif" class="porygon-sprite" alt="Porygon-Z" onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/474.gif'; this.onerror=function(){this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/474.png';};">
            
            <div class="porygon-ui">
                <div class="porygon-dialog-box">
                    <span id="porygon-text"></span>
                </div>
                
                <div id="input-container" class="user-input-container">
                    <div class="input-wrapper">
                        <input type="text" id="username" class="login-input" placeholder="Identifiant..." autocomplete="off" maxlength="12">
                        <button class="login-btn" onclick="window.finishIntroSequence()">CONNECTER</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ARCHITECTURE V7.0 GENESIS - SYSTEM LOG (Murmures d'Entropie) -->
    <div id="system-log" class="system-log">
        <!-- Les murmures appara√Ætront ici dynamiquement -->
    </div>
    
    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="trainer-info" onclick="switchPage('profile')" style="cursor: pointer;">
                <span id="topbar-icon" style="font-size: 1.2em; margin-right: 8px;">üë§</span>
                <div style="flex: 1;">
                    <span class="trainer-level">Niveau: <span id="trainer-level">1</span></span>
                    <div id="topbar-title" style="font-size: 0.75em; color: rgba(255,255,255,0.7); margin-top: 2px; display: none;"></div>
                    <div class="xp-bar-container">
                        <div class="xp-bar-fill" id="xp-bar" style="width: 0%"></div>
                    </div>
                    <span class="xp-text" id="xp-text">0 / 500 XP</span>
                </div>
            </div>
        </div>
        <div class="top-bar-right">
            <!-- Jauge de Stabilit√© Syst√®me (visible pour les niveaux 1-2) -->
            <div id="system-stability-display" style="display: none; flex-direction: column; align-items: flex-end; margin-right: 10px; min-width: 120px;">
                <div style="font-size: 0.7em; color: rgba(255,255,255,0.7); margin-bottom: 3px; font-family: var(--font-family-pixel);">STABILIT√â</div>
                <div style="width: 100px; height: 8px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; position: relative;">
                    <div id="stability-bar-fill" style="height: 100%; background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); width: 0%; transition: width 0.5s ease; border-radius: 10px;"></div>
                </div>
                <div id="stability-text" style="font-size: 0.7em; color: rgba(255,255,255,0.8); margin-top: 2px; font-family: var(--font-family-pixel);">0%</div>
            </div>
            <div id="active-boosts" style="display: flex; gap: 8px; align-items: center; margin-right: 10px;"></div>
            <div class="resource-display">
                <span class="resource-icon" id="coins-icon"></span>
                <span id="coins-display">3000</span>
            </div>
            <div class="resource-display" onclick="toggleStreakTooltip()" style="cursor: pointer;">
                <span class="resource-icon" id="streak-icon"></span>
                <span id="streak-display">0</span>
            </div>
        </div>
    </div>

    <!-- PAGE: BLIND BOX -->
    <div id="home-page" class="page active">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 20px;">üéÅ Blind Box</h1>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-icon" id="stat-icon-pokedex"></div>
                    <div class="stat-value" id="pokedex-count">0</div>
                    <div class="stat-label">Pok√©mon captur√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" id="stat-icon-shiny"></div>
                    <div class="stat-value" id="shiny-count">0</div>
                    <div class="stat-label">Shinies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" id="stat-icon-streak"></div>
                    <div class="stat-value" id="best-streak">0</div>
                    <div class="stat-label">Meilleur streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" id="stat-icon-blindbox"></div>
                    <div class="stat-value" id="blindbox-count">5/5</div>
                    <div class="stat-label">Blind Box dispo</div>
                </div>
            </div>

            <div class="game-section">
                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3)); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="color: white; margin-bottom: 15px;">üêæ Compagnon Buddy</h3>
                    <div id="buddy-home-display" style="text-align: center;">
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 15px;">Aucun Buddy s√©lectionn√©</p>
                        <button onclick="window.showBuddySelection && window.showBuddySelection();" class="btn btn--primary" style="padding: 12px 24px;">
                            Choisir un Buddy
                        </button>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(147, 51, 234, 0.3), rgba(236, 72, 153, 0.3)); padding: 40px; border-radius: 20px; text-align: center; margin-bottom: 30px;">
                    <div id="blindbox-gift-3d-container" style="width: 150px; height: 150px; margin: 0 auto 20px; border-radius: 20px; background: radial-gradient(circle, #2a2a40 0%, #0f0f15 100%); box-shadow: 0 0 50px rgba(255, 215, 0, 0.2); position: relative; animation: shine 2s infinite;"></div>
                    <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 10px; color: white;">
                        Blind Box disponibles: <span id="blindbox-count-page">5/5</span>
                    </div>
                    <div style="font-size: 0.9em; color: rgba(255,255,255,0.7); margin-bottom: 10px;" id="pity-counter">
                        0/20 vers L√©gendaire garanti
                    </div>
                    <div id="blindbox-timer" style="font-size: 0.85em; color: #FFD700; margin-bottom: 10px; display: none;"></div>
                    <button onclick="openBlindBox()" class="btn btn--primary btn--large" style="padding: 15px 40px; font-size: 1.2em;">
                        ‚ú® Ouvrir une Blind Box ‚ú®
                    </button>
                    <button onclick="rechargeBlindBoxSlots()" class="btn btn--outline" style="padding: 12px 30px; font-size: 1em; margin-top: 15px; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; display: block;">
                        üîÑ Recharger les slots (5/5)
                    </button>
                </div>
                
                <div style="background: var(--dark-surface); padding: 20px; border-radius: 15px;">
                    <h3 style="margin-bottom: 15px;">üìú Historique r√©cent</h3>
                    <div id="blindbox-history"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE: CAPTURE -->
    <div id="capture-page" class="page">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 20px;">‚öæ Capture & P√™che</h1>
            
            <div class="capture-tabs">
                <button class="capture-tab-button active" onclick="switchCaptureTab('capture')">‚öæ Capture</button>
                <button class="capture-tab-button" onclick="scrollToPeche()">üé£ P√™che</button>
            </div>
            
            <div class="game-section" id="capture-section">
                <div id="encounter" style="min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)); border-radius: 12px; padding: 40px;">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Ccircle cx='100' cy='100' r='95' fill='%23ee1515'/%3E%3Ccircle cx='100' cy='100' r='95' fill='none' stroke='%23000' stroke-width='5'/%3E%3Crect x='0' y='95' width='200' height='10' fill='%23000'/%3E%3Ccircle cx='100' cy='100' r='60' fill='white'/%3E%3Ccircle cx='100' cy='100' r='60' fill='none' stroke='%23000' stroke-width='5'/%3E%3Ccircle cx='100' cy='100' r='30' fill='white'/%3E%3Ccircle cx='100' cy='100' r='30' fill='none' stroke='%23000' stroke-width='5'/%3E%3Ccircle cx='100' cy='100' r='15' fill='%23000'/%3E%3C/svg%3E" style="width: 200px; height: 200px;">
                </div>
                <button id="spawn-btn" class="btn btn--primary btn--large" style="width: 100%; margin-top: 15px; padding: 15px; font-size: 1.1em; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="if(typeof window.spawnPokemon==='function'){window.spawnPokemon();}else if(typeof spawnPokemon==='function'){spawnPokemon();}else{console.error('spawnPokemon non disponible');}">
                    <span id="spawn-btn-text">Capturer un Pok√©mon</span>
                </button>
                
                <div style="background: var(--dark-surface); padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: white;">üìú Historique des rencontres</h3>
                    <div id="capture-history"></div>
                </div>
            </div>
            
            <div class="game-section" id="fishing-section" style="margin-top: 50px; scroll-margin-top: 100px; position: relative;">
                <h2 style="text-align: center; margin-bottom: 20px;">üé£ P√™che</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 20px;">
                    <span id="fishing-unlock-text">D√©bloqu√© au niveau 2.</span>
                </p>
                
                <div id="fishing-zone" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(14, 165, 233, 0.3)); padding: 40px; border-radius: 20px; text-align: center; position: relative;">
                    <div id="fishing-wave-3d-container" style="width: 100%; height: 200px; margin: 0 auto 20px; border-radius: 20px; background: linear-gradient(to bottom, #1a1a2e 0%, #0d47a1 100%); position: relative; overflow: hidden;"></div>
                    <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 10px; color: white;">
                        Jetons de p√™che: <span id="fishing-tokens">10</span> üé£
                    </div>
                    <div id="fishing-token-timer" style="font-size: 0.85em; color: #FFD700; margin-bottom: 10px; display: none;"></div>
                    <button id="fishing-btn" onclick="startFishing()" class="btn btn--primary btn--large" style="padding: 15px 40px; font-size: 1.2em;" disabled>
                        üé£ P√™cher un Pok√©mon
                    </button>
                </div>
                
                <div style="background: var(--dark-surface); padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: white;">üìú Historique des p√™ches</h3>
                    <div id="fishing-history"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE: POK√âDEX -->
    <div id="pokedex-page" class="page">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 20px;">üìö Pok√©dex</h1>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button onclick="switchPokedexMode('grid')" id="mode-grid-btn" class="btn btn--primary" style="margin-right: 10px;">üìä Dex</button>
            </div>
            
            <div style="background: var(--dark-surface); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px;">
                    <select id="pokedex-filter-status" onchange="filterPokedex()" style="padding: 10px; border-radius: 8px; background: var(--dark-elevated); border: 2px solid var(--dark-border); color: white; font-size: 14px;">
                        <option value="all">Tous</option>
                        <option value="caught">Captur√©s</option>
                        <option value="not-caught">Non captur√©s</option>
                        <option value="shiny">Shiny</option>
                    </select>
                    <select id="pokedex-filter-rarity" onchange="filterPokedex()" style="padding: 10px; border-radius: 8px; background: var(--dark-elevated); border: 2px solid var(--dark-border); color: white; font-size: 14px;">
                        <option value="all">Toutes raret√©s</option>
                        <option value="common">Commun</option>
                        <option value="uncommon">Peu Commun</option>
                        <option value="rare">Rare</option>
                        <option value="super_rare">Super Rare</option>
                        <option value="legendary">L√©gendaire</option>
                    </select>
                    <select id="pokedex-filter-type" onchange="filterPokedex()" style="padding: 10px; border-radius: 8px; background: var(--dark-elevated); border: 2px solid var(--dark-border); color: white; font-size: 14px;">
                        <option value="all">Tous types</option>
                        <option value="Normal">Normal</option>
                        <option value="Fire">Feu</option>
                        <option value="Water">Eau</option>
                        <option value="Electric">√âlectrik</option>
                        <option value="Grass">Plante</option>
                        <option value="Ice">Glace</option>
                        <option value="Fighting">Combat</option>
                        <option value="Poison">Poison</option>
                        <option value="Ground">Sol</option>
                        <option value="Flying">Vol</option>
                        <option value="Psychic">Psy</option>
                        <option value="Bug">Insecte</option>
                        <option value="Rock">Roche</option>
                        <option value="Ghost">Spectre</option>
                        <option value="Dragon">Dragon</option>
                    </select>
                    <select id="pokedex-filter-evolvable" onchange="filterPokedex()" style="padding: 10px; border-radius: 8px; background: var(--dark-elevated); border: 2px solid var(--dark-border); color: white; font-size: 14px;">
                        <option value="all">Tous</option>
                        <option value="evolvable">√âvoluables uniquement</option>
                    </select>
                </div>
                <div style="text-align: center;">
                    <div style="color: var(--text-secondary); margin-bottom: 5px;">R√©gion actuelle</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #667eea;" id="current-region-display">Kanto</div>
                    <div style="color: var(--text-secondary); font-size: 0.9em; margin-top: 5px;">
                        <span id="region-progress-display">0/151</span> Pok√©mon captur√©s
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap;">
                <button id="region-tab-kanto" class="btn btn--primary" onclick="switchPokedexRegion('Kanto')" style="padding: 10px 20px;">
                    üåã Kanto
                </button>
                <button id="region-tab-johto" class="btn btn--outline" onclick="switchPokedexRegion('Johto')" style="padding: 10px 20px;">
                    üèîÔ∏è Johto
                </button>
                <button id="region-tab-hoenn" class="btn btn--outline" onclick="switchPokedexRegion('Hoenn')" style="padding: 10px 20px;">
                    üåä Hoenn
                </button>
            </div>
            
            <div id="pokemon-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px;"></div>
            <div id="pokemon-list" style="display: none;"></div>
        </div>
    </div>

    <!-- PAGE: BOUTIQUE -->
    <div id="shop-page" class="page">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 20px;">üõí Boutique</h1>
            
            <div class="shop-tabs">
                <button class="shop-tab-button active" onclick="scrollToSection('shop-pokeballs')">‚öæ Pok√©balls</button>
                <button class="shop-tab-button" onclick="scrollToSection('shop-berries')">üçì Baies</button>
                <button class="shop-tab-button" onclick="scrollToSection('shop-items')">‚ú® Objets</button>
                <button class="shop-tab-button" onclick="scrollToSection('shop-lootboxes')">üéÅ Lootboxes</button>
            </div>
            
            <div id="shop-content" style="max-width: 800px; margin: 0 auto;">
                <div id="shop-pokeballs" class="shop-section"><h2>‚öæ Pok√©balls</h2><div id="shop-pokeballs-items"></div></div>
                <div id="shop-berries" class="shop-section" style="margin-top: 40px;"><h2>üçì Baies</h2><div id="shop-berries-items"></div></div>
                <div id="shop-items" class="shop-section" style="margin-top: 40px;"><h2>‚ú® Objets Sp√©ciaux</h2><div id="shop-items-items"></div></div>
                <div id="shop-lootboxes" class="shop-section" style="margin-top: 40px;"><h2 style="display: flex; align-items: center; gap: 10px;">üéÅ Lootboxes <span onclick="showLootboxInfo()" style="cursor: pointer; font-size: 1em; color: #ffd700; background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3)); width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s; border: 2px solid rgba(255,215,0,0.6); box-shadow: 0 0 15px rgba(255,215,0,0.4); animation: pulse 2s infinite;" onmouseenter="this.style.background='linear-gradient(135deg, rgba(255,215,0,0.5), rgba(255,165,0,0.5))'; this.style.borderColor='rgba(255,215,0,0.9)'; this.style.transform='scale(1.2)'; this.style.boxShadow='0 0 25px rgba(255,215,0,0.7)'; this.style.animation='none'" onmouseleave="this.style.background='linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3))'; this.style.borderColor='rgba(255,215,0,0.6)'; this.style.transform='scale(1)'; this.style.boxShadow='0 0 15px rgba(255,215,0,0.4)'; this.style.animation='pulse 2s infinite'" title="üí° En savoir plus sur les Lootboxes">‚ÑπÔ∏è</span></h2><div id="shop-lootboxes-items"></div></div>
            </div>
        </div>
    </div>

    <!-- PAGE: QU√äTES -->
    <div id="quests-page" class="page">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 20px;">‚ú® Qu√™tes & D√©fis</h1>
            
            <div class="quest-tabs">
                <button class="quest-tab-button active" onclick="scrollToSection('quests-daily')">üìÖ Quotidiennes</button>
                <button class="quest-tab-button" onclick="scrollToSection('quests-special')">üéØ Sp√©ciales</button>
                <button class="quest-tab-button" onclick="scrollToSection('quests-permanent')">üèÜ Permanentes</button>
            </div>
            
            <div id="quests-daily" class="game-section" style="margin-bottom: 30px;"><h2>üìÖ Qu√™tes Quotidiennes</h2><div id="daily-quests-container"></div></div>
            <div id="quests-special" class="game-section" style="margin-bottom: 30px;"><h2>üéØ Qu√™tes Sp√©ciales</h2><div id="special-quests-container"></div></div>
            <div id="quests-permanent" class="game-section"><h2>üèÜ Challenges Permanents</h2><div id="permanent-quests-container"></div></div>
        </div>
    </div>

    <!-- PAGE: INVENTAIRE -->
    <div id="inventory-page" class="page">
        <div class="container" style="max-width: 800px;">
            <h1 style="text-align: center; margin-bottom: 20px;">üéí Inventaire</h1>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <label style="color: var(--text-secondary); cursor: pointer;">
                    <input type="checkbox" id="show-unowned" onchange="renderInventory()" style="margin-right: 8px;">
                    Afficher les objets non obtenus
                </label>
            </div>
            
            <div id="inventory-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;"></div>
        </div>
    </div>

    <!-- PAGE: PROFIL -->
    <div id="profile-page" class="page">
        <div class="container" style="max-width: 700px;">
            <h1 style="text-align: center; margin-bottom: 30px;">üë§ Profil Dresseur</h1>
            
            <div id="profile-header-bg" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3)); padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 30px; position: relative;">
                <div style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 0.9em; color: rgba(255,255,255,0.4); transition: all 0.3s; display: flex; align-items: center; gap: 4px;" onmouseenter="this.style.color='rgba(255,255,255,0.7)'" onmouseleave="this.style.color='rgba(255,255,255,0.4)'" onclick="openCustomizationEditor('icon')" title="√âditer l'ic√¥ne"><span style="filter: grayscale(100%); opacity: 0.5;">‚úèÔ∏è</span><span style="font-size: 0.75em;">Ic√¥ne</span></div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                    <div id="profile-icon" style="font-size: 3em; flex-shrink: 0;">üë§</div>
                    <div style="position: relative; display: flex; align-items: center; gap: 8px;">
                        <div id="profile-name" style="font-size: 1.8em; font-weight: bold; color: white;">
                            Dresseur Niveau <span id="profile-level">1</span>
                        </div>
                        <span style="cursor: pointer; font-size: 0.8em; color: rgba(255,255,255,0.4); transition: all 0.3s; display: flex; align-items: center; gap: 3px; flex-shrink: 0;" onmouseenter="this.style.color='rgba(255,255,255,0.7)'" onmouseleave="this.style.color='rgba(255,255,255,0.4)'" onclick="editTrainerName()" title="√âditer le nom"><span style="filter: grayscale(100%); opacity: 0.5;">‚úèÔ∏è</span><span style="font-size: 0.7em;">Nom</span></span>
                    </div>
                </div>
                <div id="profile-title" style="font-size: 1em; color: rgba(255,255,255,0.9); margin-bottom: 10px; font-style: italic; display: none;"></div>
                <div id="profile-title-edit" style="position: absolute; bottom: 10px; left: 10px; cursor: pointer; font-size: 0.9em; color: rgba(255,255,255,0.4); transition: all 0.3s; display: none; align-items: center; gap: 4px;" onmouseenter="this.style.color='rgba(255,255,255,0.7)'" onmouseleave="this.style.color='rgba(255,255,255,0.4)'" onclick="openCustomizationEditor('title')" title="√âditer le titre"><span style="filter: grayscale(100%); opacity: 0.5;">‚úèÔ∏è</span><span style="font-size: 0.75em;">Titre</span></div>
                <div style="position: relative; display: inline-block; width: 100%; max-width: 300px;">
                    <div style="color: rgba(255,255,255,0.8); margin-bottom: 15px;">
                        <span id="profile-xp">0</span> / <span id="profile-xp-next">500</span> XP
                    </div>
                    <div style="width: 100%; height: 15px; background: rgba(0,0,0,0.3); border-radius: 15px; overflow: hidden; margin: 0 auto; position: relative;">
                        <div id="profile-xp-bar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); width: 0%; transition: width 0.5s;"></div>
                        <div id="xp-bar-edit-btn" onclick="openCustomizationEditor('xpbar')" style="display: none; position: absolute; top: 50%; right: 10px; transform: translateY(-50%); cursor: pointer; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 0.8em; color: rgba(255,255,255,0.4); transition: all 0.3s;" onmouseenter="this.style.color='rgba(255,255,255,0.7)'" onmouseleave="this.style.color='rgba(255,255,255,0.4)'" title="√âditer la barre XP">‚úèÔ∏è</div>
                    </div>
                </div>
                <div style="position: absolute; bottom: 10px; right: 10px; cursor: pointer; font-size: 0.9em; color: rgba(255,255,255,0.4); transition: all 0.3s; display: flex; align-items: center; gap: 4px;" onmouseenter="this.style.color='rgba(255,255,255,0.7)'" onmouseleave="this.style.color='rgba(255,255,255,0.4)'" onclick="openCustomizationEditor('background')" title="√âditer le background"><span style="filter: grayscale(100%); opacity: 0.5;">‚úèÔ∏è</span><span style="font-size: 0.75em;">Fond</span></div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-label">Pok√©dex</div>
                    <div class="stat-value" id="profile-pokedex">0</div>
                    <div style="font-size: 0.9em; color: #666;">/ 151</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Captur√©s</div>
                    <div class="stat-value" id="profile-total">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Shinies</div>
                    <div class="stat-value" style="color: #FFD700;" id="profile-shinies">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Meilleur Streak</div>
                    <div class="stat-value" style="color: #f97316;" id="profile-best-streak">0</div>
                </div>
            </div>
            
            <div class="game-section" style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">üåç R√©gions</h3>
                <div id="regions-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;"></div>
            </div>

            <div class="game-section" style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">üìä Statistiques</h3>
                <div style="display: grid; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
                        <span>‚è±Ô∏è Temps de jeu</span>
                        <span id="stat-playtime">0h 0m</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
                        <span>üéØ Taux de r√©ussite</span>
                        <span id="stat-success-rate">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
                        <span>üì¶ Blind Box ouvertes</span>
                        <span id="stat-blindbox">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
                        <span>üé£ Pok√©mon p√™ch√©s</span>
                        <span id="stat-fished">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
                        <span>üí∞ Coins gagn√©s (total)</span>
                        <span id="stat-coins-earned">0</span>
                    </div>
                </div>
            </div>

            <!-- Section Leaderboard -->
            <div class="game-section" style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">üèÜ Classements</h3>
                <button onclick="switchPage('leaderboard')" class="btn btn--primary" style="width: 100%; padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #a855f7, #7d5fff); border: none; border-radius: 12px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);">
                    üìä Voir les Leaderboards
                </button>
                <p style="color: rgba(255,255,255,0.6); text-align: center; margin-top: 10px; font-size: 0.9em;">
                    Top PDG ‚Ä¢ Top Collectionneur ‚Ä¢ Top Strat√®ge
                </p>
            </div>

            <!-- Section Sauvegarde Cloud -->
            <div class="game-section" style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)); padding: 20px; border-radius: 15px; border: 2px solid rgba(102, 126, 234, 0.3);">
                <h3 style="margin-bottom: 15px; color: white;">üíæ Archivage des Donn√©es</h3>
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 15px; font-size: 0.9em;">Archivez les donn√©es r√©cup√©r√©es pour les synchroniser sur tous vos terminaux.</p>
                <div id="profile-cloud-section" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; justify-content: center;">
                    <!-- Le bouton sera ajout√© dynamiquement par updateAuthUI -->
                </div>
                <div id="profile-cloud-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <!-- Boutons d'action cloud (charger/sauvegarder) -->
                </div>
            </div>

            <div style="text-align: center;">
                <button id="refresh-page-btn" class="btn btn--outline" style="background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; color: #3b82f6;" onclick="window.location.reload()">
                    üîÑ Refresh
                </button>
            </div>
        </div>
    </div>

    <!-- PAGE: POK√â-POKER -->
    <div id="poker-page" class="page crt" style="background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%); min-height: 100vh; position: relative;">
        <div id="poker-root"></div>
    </div>

    <!-- PAGE: EXPEDITION -->
    <div id="expedition-page" class="page">
        <div class="container" id="expedition-container">
            <!-- Content will be dynamically generated -->
        </div>
    </div>

    <!-- PAGE: RECHERCHE -->
    <div id="leaderboard-page" class="page">
        <!-- Contenu g√©n√©r√© par renderLeaderboard() -->
    </div>
    
    <div id="research-page" class="page">
        <!-- Content will be dynamically generated -->
    </div>

    <!-- PAGE: DATA GUARDIANS (BOSS BATTLE) -->
    <div id="boss-battle-page" class="page">
        <div class="container" id="boss-battle-container">
            <!-- Content will be dynamically generated -->
        </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <div class="hub-overlay" id="hubOverlay" onclick="toggleHub()">
        <div class="hub-grid" onclick="event.stopPropagation()">
            <div class="hub-item quests" onclick="selectHubItem('quests')">
                <div class="hub-notif" id="hub-notif-quests" style="display:none;">!</div>
                <div class="hub-icon">‚ú®</div>
                <div class="hub-label">Qu√™tes</div>
                <div class="hub-desc">Objectifs & D√©fis</div>
            </div>
            <div class="hub-item inventory" onclick="selectHubItem('inventory')">
                <div class="hub-icon">üéí</div>
                <div class="hub-label">Inventaire</div>
                <div class="hub-desc">Objets & ≈íufs</div>
            </div>
            <div class="hub-item pokedex" onclick="selectHubItem('pokedex')">
                <div class="hub-icon">üìö</div>
                <div class="hub-label">Pok√©dex</div>
                <div class="hub-desc">Collection 100%</div>
            </div>
            <div class="hub-item shop" onclick="selectHubItem('shop')">
                <div class="hub-icon">üõí</div>
                <div class="hub-label">Boutique</div>
                <div class="hub-desc">Packs & Jokers</div>
            </div>
            <div class="hub-item research" onclick="selectHubItem('research')">
                <div class="hub-icon">‚ö°</div>
                <div class="hub-label">Recherche</div>
                <div class="hub-desc">√ânergie Onirique</div>
            </div>
            <div class="hub-item bossBattle" onclick="selectHubItem('bossBattle')">
                <div class="hub-icon">üõ°Ô∏è</div>
                <div class="hub-label">Data Guardians</div>
                <div class="hub-desc">Combat de Boss</div>
            </div>
        </div>
    </div>

    <nav class="new-bottom-nav">
        <button class="nav-btn active" id="nav-btn-home" onclick="selectNav('home')">
            <span class="nav-icon">üéÅ</span>
            <span class="nav-label">Box</span>
        </button>

        <button class="nav-btn" id="nav-btn-capture" onclick="selectNav('capture')">
            <span class="nav-icon" id="nav-capture-icon"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png" style="width: 24px; height: 24px; image-rendering: pixelated; vertical-align: middle; display: inline-block; object-fit: contain;" alt="Master Ball" onerror="this.style.display='none'; this.parentElement.innerHTML='üíú';"></span>
            <span class="nav-label">Capture</span>
        </button>

        <div class="nav-hub-wrapper" id="hubWrapper">
            <button class="nav-hub-btn" onclick="toggleHub()">
                <img id="hubIcon" src="assets/icons/pokeball-hub.png" alt="Menu" class="hub-icon-img" onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png'">
            </button>
        </div>

        <button class="nav-btn" id="nav-btn-expedition" onclick="selectNav('expedition')">
            <span class="nav-icon">üó∫Ô∏è</span>
            <span class="nav-label">Exp√©dition</span>
        </button>

        <button class="nav-btn" id="nav-btn-poker" onclick="selectNav('poker')">
            <span class="nav-icon">üÉè</span>
            <span class="nav-label">Pok√©-Poker</span>
        </button>
    </nav>

    <script>
        let isHubOpen = false;

        function toggleHub() {
            isHubOpen = !isHubOpen;
            const overlay = document.getElementById('hubOverlay');
            const wrapper = document.getElementById('hubWrapper');

            if (isHubOpen) {
                overlay.classList.add('active');
                wrapper.classList.add('hub-open');
                if (window.navigator && window.navigator.vibrate) try { window.navigator.vibrate(10); } catch(e){}
            } else {
                overlay.classList.remove('active');
                wrapper.classList.remove('hub-open');
            }
        }

        function selectNav(pageName) {
            if (isHubOpen) toggleHub();
            updateActiveNav(pageName);
            if (window.switchPage) window.switchPage(pageName);
        }

        function selectHubItem(pageName) {
            // ‚úÖ CORRECTION : Protection renforc√©e pour bloquer les qu√™tes au niveau 1
            if (pageName === 'quests') {
                if (!window.gameState || !window.gameState.modules || !window.gameState.modules.quests || 
                    (!window.gameState.modules.quests.unlocked && (window.gameState.level < 2 || window.gameState.level === 1))) {
                    if (window.showToast) window.showToast('üîí Les Qu√™tes seront d√©bloqu√©es au niveau 2 !', 'error');
                    return;
                }
            }
            
            // ‚úÖ Protection : Bloquer le Laboratoire jusqu'au niveau 5
            if (pageName === 'research') {
                if (!window.gameState || !window.gameState.research || 
                    (!window.gameState.research.unlocked && window.gameState.level < 5)) {
                    if (window.showToast) window.showToast('üîí Le Centre de Recherche sera d√©bloqu√© au niveau 5 !', 'error');
                    return;
                }
            }
            
            // ‚úÖ Protection : Bloquer Data Guardians jusqu'au niveau 8
            if (pageName === 'bossBattle') {
                if (!window.gameState || !window.gameState.modules || !window.gameState.modules.bossBattle || 
                    (!window.gameState.modules.bossBattle.unlocked && window.gameState.level < 8)) {
                    if (window.showToast) window.showToast('üîí Les Data Guardians seront d√©bloqu√©s au niveau 8 !', 'error');
                    return;
                }
            }
            
            toggleHub();
            // D√©sactive la surbrillance du bas quand on est dans une sous-page du Hub
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (window.switchPage) window.switchPage(pageName);
        }

        function updateActiveNav(pageName) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById('nav-btn-' + pageName);
            if (btn) btn.classList.add('active');
        }
    </script>

    <!-- LOAD JAVASCRIPT -->
    <!-- Ordre de chargement critique pour √©viter les erreurs de d√©pendances -->
    <!-- 1. Supabase (doit √™tre disponible pour app.js dans saveGame) -->
    <script src="supabase_manager.js"></script>
    <script src="supabase_ui.js"></script>
    <!-- ARCHITECTURE V7.0 GENESIS - Configuration API (Z√©ro-Asset) -->
    <script src="config/api_endpoints.js"></script>
    <!-- ARCHITECTURE V7.0 GENESIS - Bible Narrative -->
    <script src="data/narrative_db.js"></script>
    <!-- 2. Moteur 3D Genesis (doit √™tre charg√© avant app.js) -->
    <script src="genesis-3d.js"></script>
    <!-- 3. app.js d√©finit gameState (expos√© sur window.gameState) -->
    <script src="app.js"></script>
    <!-- PROTOCOLE DATA GUARDIAN - Syst√®me de Combat Boss -->
    <script src="boss_battle_system.js"></script>
    <!-- 3. Scripts qui d√©pendent de gameState (charg√©s apr√®s app.js) -->
    <script src="capture_minigame_logic.js"></script>
    <script src="game_extensions.js"></script>
    <script src="poker_meta_shop.js"></script>
    <script src="premium_fx.js"></script>
    <script src="fishing_overhaul.js"></script>
    <!-- 4. PWA UI - Gestion de l'installation -->
    <script src="pwa_ui.js"></script>
    
    <!-- POK√â-POKER GAME SCRIPT - Code complet fourni par l'utilisateur -->
    <script>
        // QA & POLISHING : Chargement robuste du Pok√©-Poker avec gestion d'erreurs am√©lior√©e
        (function() {
            let initAttempts = 0;
            const MAX_INIT_ATTEMPTS = 50; // Augment√© √† 25 secondes (50 * 500ms) pour les t√©l√©phones lents
            let babelCompileStartTime = null;
            
            // Fonction pour initialiser le composant React apr√®s que Babel ait compil√©
            function tryInitPokerApp() {
                initAttempts++;
                const rootElement = document.getElementById('poker-root');
                
                // V√©rifications de d√©bogage
                if (initAttempts === 1) {
                    console.log('üéÆ Initialisation Pok√©-Poker...');
                    console.log('React disponible:', typeof React !== 'undefined');
                    console.log('ReactDOM disponible:', typeof ReactDOM !== 'undefined');
                    console.log('Babel disponible:', typeof Babel !== 'undefined');
                    console.log('poker-root existe:', !!rootElement);
                }
                
                // V√©rifier les d√©pendances critiques
                if (!rootElement) {
                    if (initAttempts < MAX_INIT_ATTEMPTS) {
                        setTimeout(tryInitPokerApp, 200);
                    } else {
                        console.error('‚ùå Timeout: poker-root n\'existe pas');
                    }
                    return;
                }
                
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    if (initAttempts < MAX_INIT_ATTEMPTS) {
                        setTimeout(tryInitPokerApp, 200);
                    } else {
                        console.error('‚ùå Timeout: React ou ReactDOM ne sont pas disponibles');
                        rootElement.innerHTML = '<div style="color: white; text-align: center; padding: 40px; font-family: VT323, monospace;">Erreur: React n\'est pas charg√©.<br><small>V√©rifiez votre connexion internet.</small></div>';
                    }
                    return;
                }
                
                // V√©rifier si Babel est en train de compiler
                if (typeof Babel === 'undefined') {
                    if (initAttempts < MAX_INIT_ATTEMPTS) {
                        setTimeout(tryInitPokerApp, 200);
                    } else {
                        console.error('‚ùå Timeout: Babel n\'est pas disponible');
                        rootElement.innerHTML = '<div style="color: white; text-align: center; padding: 40px; font-family: VT323, monospace;">Erreur: Babel n\'est pas charg√©.<br><small>V√©rifiez votre connexion internet.</small></div>';
                    }
                    return;
                }
                
                // V√©rifier si App est d√©fini (compil√© par Babel)
                if (typeof App !== 'undefined') {
                    try {
                        console.log('‚úÖ Rendu du composant Pok√©-Poker...');
                        const root = ReactDOM.createRoot(rootElement);
                        // Utiliser React.createElement car nous sommes en JavaScript pur, pas en JSX
                        root.render(React.createElement(App));
                        console.log('‚úÖ Pok√©-Poker initialis√© avec succ√®s!');
                        if (babelCompileStartTime) {
                            console.log('‚è±Ô∏è Temps de compilation Babel:', Date.now() - babelCompileStartTime, 'ms');
                        }
                        return; // Succ√®s
                    } catch (error) {
                        console.error('‚ùå Erreur lors du rendu du composant Pok√©-Poker:', error);
                        rootElement.innerHTML = '<div style="color: white; text-align: center; padding: 40px; font-family: VT323, monospace;">Erreur de chargement du jeu Pok√©-Poker.<br><small>' + error.message + '</small><br><button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #a855f7; color: white; border: none; border-radius: 8px; cursor: pointer;">Recharger</button></div>';
                        return; // Erreur
                    }
                } else {
                    // App n'est pas encore d√©fini, Babel n'a peut-√™tre pas encore compil√©
                    if (!babelCompileStartTime && initAttempts > 5) {
                        // Si on attend depuis plus de 5 tentatives, Babel est probablement en train de compiler
                        babelCompileStartTime = Date.now();
                    }
                    
                    if (initAttempts < MAX_INIT_ATTEMPTS) {
                        if (initAttempts % 10 === 0) {
                            console.log('‚è≥ En attente de la compilation Babel... (tentative ' + initAttempts + '/' + MAX_INIT_ATTEMPTS + ')');
                        }
                        setTimeout(tryInitPokerApp, 500);
                    } else {
                        console.error('‚ùå Timeout: Le composant App n\'a pas √©t√© compil√© par Babel apr√®s ' + MAX_INIT_ATTEMPTS + ' tentatives');
                        rootElement.innerHTML = '<div style="color: white; text-align: center; padding: 40px; font-family: VT323, monospace;">Erreur: Le jeu Pok√©-Poker n\'a pas pu √™tre charg√©.<br><small>Le composant App n\'a pas √©t√© trouv√© apr√®s ' + (MAX_INIT_ATTEMPTS * 500 / 1000) + ' secondes.<br>Votre appareil est peut-√™tre trop lent. Essayez de recharger la page.</small><br><button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #a855f7; color: white; border: none; border-radius: 8px; cursor: pointer;">Recharger</button></div>';
                    }
                }
            }
            
            // Fonction pour charger le fichier JSX
            function loadPokerGame() {
                // V√©rifier que React et ReactDOM sont disponibles
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    console.error('‚ùå React ou ReactDOM ne sont pas disponibles');
                    return;
                }
                
                fetch('poker-game-full.jsx')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erreur HTTP: ' + response.status);
                        }
                        return response.text();
                    })
                    .then(code => {
                        console.log('üì¶ Chargement du fichier poker-game-full.jsx...');
                        
                        // V√©rifier que Babel est disponible
                        if (typeof Babel === 'undefined') {
                            throw new Error('Babel n\'est pas disponible');
                        }
                        
                        console.log('‚öôÔ∏è Compilation du JSX avec Babel...');
                        const compileStartTime = Date.now();
                        try {
                            // QA & POLISHING : Compilation Babel avec gestion d'erreurs am√©lior√©e
                            const compiledCode = Babel.transform(code, {
                                presets: ['react'],
                                // Options suppl√©mentaires pour am√©liorer la compatibilit√©
                                compact: false,
                                retainLines: false
                            }).code;
                            
                            const compileTime = Date.now() - compileStartTime;
                            console.log('‚úÖ Code compil√© avec succ√®s en ' + compileTime + 'ms, ex√©cution...');
                            
                            // V√©rifier si le script a d√©j√† √©t√© ajout√©
                            const existingScript = document.getElementById('poker-game-script');
                            if (existingScript) {
                                existingScript.remove();
                            }
                            
                            // Ex√©cuter le code compil√©
                            const script = document.createElement('script');
                            script.id = 'poker-game-script';
                            script.textContent = compiledCode;
                            
                            // QA & POLISHING : Ajouter un gestionnaire d'erreur au script
                            script.onerror = function(error) {
                                console.error('‚ùå Erreur d\'ex√©cution du script compil√©:', error);
                                const rootElement = document.getElementById('poker-root');
                                if (rootElement) {
                                    rootElement.innerHTML = '<div style="color: white; text-align: center; padding: 40px; font-family: VT323, monospace;">Erreur d\'ex√©cution du code compil√©.<br><small>' + error.message + '</small><br><button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #a855f7; color: white; border: none; border-radius: 8px; cursor: pointer;">Recharger</button></div>';
                                }
                            };
                            
                            document.head.appendChild(script);
                            
                            // QA & POLISHING : Attendre un peu plus longtemps pour les appareils lents
                            setTimeout(tryInitPokerApp, 1000); // Augment√© de 500ms √† 1000ms
                        } catch (compileError) {
                            console.error('‚ùå Erreur de compilation Babel:', compileError);
                            const rootElement = document.getElementById('poker-root');
                            if (rootElement) {
                                rootElement.innerHTML = '<div style="color: white; text-align: center; padding: 40px; font-family: VT323, monospace;">Erreur de compilation Babel.<br><small>' + compileError.message + '</small><br><button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #a855f7; color: white; border: none; border-radius: 8px; cursor: pointer;">Recharger</button></div>';
                            }
                            throw compileError;
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Erreur de chargement du fichier poker-game-full.jsx:', error);
                        // Fallback: initialisation basique
                        const rootElement = document.getElementById('poker-root');
                        if (rootElement && typeof ReactDOM !== 'undefined') {
                            const root = ReactDOM.createRoot(rootElement);
                            root.render(React.createElement('div', { 
                                className: 'text-white text-center p-8',
                                style: { padding: '40px', fontFamily: 'VT323, monospace' }
                            }, [
                                React.createElement('h2', { key: 'title', style: { marginBottom: '20px' } }, 'Erreur de chargement'),
                                React.createElement('p', { key: 'error' }, 'Erreur: ' + error.message),
                                React.createElement('p', { key: 'reload' }, 'Veuillez recharger la page.')
                            ]));
                        }
                    });
            }
            
            // Attendre que le DOM soit pr√™t
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadPokerGame);
            } else {
                // Le DOM est d√©j√† charg√©
                setTimeout(loadPokerGame, 100);
            }
        })();
    </script>
    
    <script>
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function scrollToPeche() {
            const fishingSection = document.getElementById('fishing-section');
            if (fishingSection) {
                fishingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function switchCaptureTab(tab) {
            const captureSection = document.getElementById('capture-section');
            if (tab === 'capture' && captureSection) {
                captureSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        // Initialize Supabase Manager after page load
        document.addEventListener('DOMContentLoaded', () => {
            // Attendre que tous les scripts soient charg√©s
            setTimeout(() => {
                if (window.SupabaseManager) {
                    window.SupabaseManager.init();
                } else {
                    // Si SupabaseManager n'est pas encore charg√©, r√©essayer
                    setTimeout(() => {
                        if (window.SupabaseManager) {
                            window.SupabaseManager.init();
                        } else {
                            // Afficher quand m√™me le bouton de connexion
                            if (window.updateAuthUI) {
                                window.updateAuthUI(false);
                            }
                        }
                    }, 1000);
                }
            }, 500);
            
            // Initialiser les mod√®les 3D apr√®s chargement
            setTimeout(() => {
                if (window.initFishingWave3D) {
                    window.initFishingWave3D();
                }
                if (window.initBlindBoxGift3D) {
                    window.initBlindBoxGift3D();
                }
            }, 1000);
        });
    </script>
    
    <!-- Service Worker Registration for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            // Forcer la mise √† jour du service worker
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.update();
                }
            });
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registered:', registration.scope);
                        
                        // V√©rifier les mises √† jour imm√©diatement et p√©riodiquement
                        registration.update();
                        
                        // √âcouter les mises √† jour disponibles
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nouvelle version disponible, forcer le rechargement
                                    console.log('üîÑ Nouvelle version disponible, rechargement...');
                                    if (confirm('Une nouvelle version est disponible. Voulez-vous recharger la page ?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                        
                        // V√©rifier les mises √† jour p√©riodiquement
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Toutes les minutes
                    })
                    .catch((error) => {
                        console.warn('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
